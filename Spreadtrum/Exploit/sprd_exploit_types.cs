// ============================================================================
// SakuraEDL - SPRD Exploit Types | 展讯漏洞类型定义
// ============================================================================
// [ZH] 漏洞类型定义 - BSL 协议漏洞、FDL 签名绕过、内存读取
// [EN] Exploit Types - BSL protocol, FDL signature bypass, memory read
// [JA] エクスプロイトタイプ - BSLプロトコル、FDL署名バイパス、メモリ読取
// [KO] 익스플로잇 타입 - BSL 프로토콜, FDL 서명 우회, 메모리 읽기
// [RU] Типы эксплойтов - BSL протокол, обход подписи FDL, чтение памяти
// [ES] Tipos de exploit - Protocolo BSL, bypass de firma FDL, lectura memoria
// ============================================================================
// ⚠️ Warning: For legal purposes only (device recovery, security research)
// Copyright (c) 2025-2026 SakuraEDL | MIT License
// ============================================================================

using System;
using System.Collections.Generic;

namespace SakuraEDL.Spreadtrum.Exploit
{
    /// <summary>
    /// 展讯漏洞利用类型
    /// </summary>
    public enum SprdExploitType
    {
        None,
        BslOverflow,            // BSL 协议溢出
        FdlSignatureBypass,     // FDL 签名绕过
        MemoryRead,             // 内存读取漏洞
        Downgrade,              // 降级攻击
        DowngradeAttack,        // 降级攻击 (别名)
        HdlcOverflow,           // HDLC 帧溢出
        NvBypass,               // NV 校验绕过
        NvUnlock,               // NV 区域解锁
        SecureBootBypass,       // 安全启动绕过
        DebugMode               // 调试模式激活
    }

    /// <summary>
    /// 漏洞利用结果
    /// </summary>
    public class SprdExploitResult
    {
        public bool Success { get; set; }
        public SprdExploitType UsedExploit { get; set; }
        public string Message { get; set; }
        public byte[] ExtractedData { get; set; }
        public Dictionary<string, object> ExtraInfo { get; set; }

        public SprdExploitResult()
        {
            ExtraInfo = new Dictionary<string, object>();
        }
    }

    /// <summary>
    /// 漏洞信息
    /// </summary>
    public class SprdVulnerabilityInfo
    {
        public SprdExploitType Type { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public string CVE { get; set; }
        public int SuccessRate { get; set; }  // 1-5 星
        public bool RequiresRoot { get; set; }
        public string[] AffectedChips { get; set; }
        public string[] AffectedVersions { get; set; }
    }

    /// <summary>
    /// 漏洞检测结果
    /// </summary>
    public class SprdVulnerabilityCheckResult
    {
        public bool HasVulnerability { get; set; }
        public string Reason { get; set; }
        public SprdExploitType RecommendedExploit { get; set; }
        public List<SprdVulnerabilityInfo> AvailableExploits { get; set; }
        public bool IsUnfused { get; set; }
        public uint ChipId { get; set; }
        public string PkHash { get; set; }

        public SprdVulnerabilityCheckResult()
        {
            AvailableExploits = new List<SprdVulnerabilityInfo>();
        }
    }

    /// <summary>
    /// 展讯设备安全信息
    /// </summary>
    public class SprdSecureBootInfo
    {
        public bool IsSecureBootEnabled { get; set; }
        public bool IsEfuseLocked { get; set; }
        public bool IsAntiRollbackEnabled { get; set; }
        public uint SecurityVersion { get; set; }
        public string PublicKeyHash { get; set; }
        public byte[] RawEfuseData { get; set; }
    }

    /// <summary>
    /// Bootloader 状态信息
    /// </summary>
    public class SprdBootloaderStatus
    {
        /// <summary>是否已解锁</summary>
        public bool IsUnlocked { get; set; }
        
        /// <summary>是否为 Unfused 设备 (未熔丝)</summary>
        public bool IsUnfused { get; set; }
        
        /// <summary>是否启用安全启动</summary>
        public bool IsSecureBootEnabled { get; set; }
        
        /// <summary>安全版本号</summary>
        public uint SecurityVersion { get; set; }
        
        /// <summary>设备型号</summary>
        public string DeviceModel { get; set; }
        
        /// <summary>解锁所需类型</summary>
        public SprdUnlockType RequiredUnlockType { get; set; }
        
        /// <summary>厂商</summary>
        public string Manufacturer { get; set; }
    }

    /// <summary>
    /// 解锁类型
    /// </summary>
    public enum SprdUnlockType
    {
        /// <summary>无需解锁</summary>
        None,
        /// <summary>利用漏洞解锁 (Unfused)</summary>
        Exploit,
        /// <summary>需要厂商解锁码</summary>
        OemCode,
        /// <summary>不支持解锁</summary>
        NotSupported
    }
}
