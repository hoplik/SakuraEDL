import{H as be,o as V,c as te,a as s,d as l,w as t,h as ye,t as i,I as he,J as h,j as d,r as n,T as xe,f as z,U as Ve,x as we,b as r,S as oe,q as U,p as Ce,W as ze,Z as De,$ as Se,E as _,_ as ke,i as se}from"./index-CR8vSeWZ.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"page-header"},Le={style:{display:"flex",gap:"12px"}},Re={key:0,class:"stats-row"},Ie={class:"stat-card"},Pe={class:"stat-value"},Be={class:"stat-card"},Te={class:"stat-value"},$e={class:"stat-card"},je={class:"stat-value"},Ee={class:"stat-card"},Ne={class:"stat-value"},Me={class:"card"},qe={class:"card-body",style:{padding:"0"}},Ke={style:{"font-weight":"600",color:"#64748b"}},Oe={style:{display:"flex","flex-direction":"column",gap:"4px"}},Ae={style:{"font-weight":"600",color:"#1e293b"}},He={style:{display:"flex",gap:"8px","align-items":"center"}},Je={style:{color:"#64748b","font-size":"12px"}},We={style:{color:"#94a3b8","font-size":"11px"}},Ze={style:{"font-family":"monospace","font-size":"12px",color:"#64748b"}},Ge={style:{"font-size":"13px",color:"#64748b"}},Qe={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"space-between","align-items":"center"}},Xe={style:{"font-size":"13px",color:"#64748b"}},Ye={class:"card"},el={class:"card-body",style:{padding:"0"}},ll={style:{"font-size":"12px"}},al={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"flex-end"}},tl={__name:"SpdResources",setup(ol){const F=d(!1),A=d([]),L=d(0),R=d(1),I=d(20),D=d(""),P=d(""),H=d("resources"),x=d({}),B=d(!1),T=d([]),J=d(0),$=d(1),j=d(20),w=d(!1),E=d(!1),de=d(),S=d(null),p=se({resource_type:"fdl1",chip_id:"",chip_name:"",description:""}),C=d(!1),N=d(!1),c=se({}),f=async()=>{F.value=!0;try{const o=await h.getSpdResources({page:R.value,page_size:I.value,keyword:D.value,type:P.value});o.code===0&&(A.value=o.data.resources||[],L.value=o.data.total||0)}catch(o){console.error("加载列表失败",o)}F.value=!1},M=async()=>{try{const o=await h.getSpdAdminStats();o.code===0&&(x.value=o.data)}catch(o){console.error("加载统计失败",o)}},q=async()=>{B.value=!0;try{const o=await h.getSpdLogs({page:$.value,page_size:j.value,keyword:D.value});o.code===0&&(T.value=o.data.logs||[],J.value=o.data.total||0)}catch(o){console.error("加载日志失败",o)}B.value=!1},ne=o=>{o==="logs"&&T.value.length===0&&q()},ie=()=>{Object.assign(p,{resource_type:"fdl1",chip_id:"",chip_name:"",description:""}),S.value=null,w.value=!0},ue=o=>{S.value=o.raw},pe=async()=>{if(!S.value){_.warning("请选择文件");return}E.value=!0;try{const o=new FormData;o.append("file",S.value),o.append("resource_type",p.resource_type),o.append("chip_id",p.chip_id),o.append("chip_name",p.chip_name),o.append("description",p.description);const e=await h.uploadSpdResource(o);e.code===0?(_.success("上传成功"),w.value=!1,f(),M()):_.error(e.message||"上传失败")}catch{_.error("上传失败")}E.value=!1},re=o=>{Object.assign(c,o),C.value=!0},ce=async()=>{N.value=!0;try{const o=await h.updateSpdResource(c.id,c);o.code===0?(_.success("保存成功"),C.value=!1,f()):_.error(o.message||"保存失败")}catch{_.error("保存失败")}N.value=!1},W=async(o,e)=>{try{(await h.updateSpdResource(o.id,{is_enabled:e})).code===0&&(_.success(e?"已启用":"已禁用"),f())}catch{_.error("操作失败")}},_e=async o=>{try{await ke.confirm(`确定要删除 "${o.filename}" 吗？`,"确认删除",{type:"warning"});const e=await h.deleteSpdResource(o.id);e.code===0?(_.success("删除成功"),f(),M()):_.error(e.message||"删除失败")}catch(e){e!=="cancel"&&_.error("删除失败")}},fe=o=>o?o<1024?o+" B":o<1024*1024?(o/1024).toFixed(1)+" KB":(o/1024/1024).toFixed(2)+" MB":"-",me=o=>({fdl1:"FDL1",fdl2:"FDL2",pac:"Pac",other:"其他"})[o]||o;return be(()=>{f(),M()}),(o,e)=>{const y=n("el-icon"),b=n("el-input"),m=n("el-option"),Z=n("el-select"),v=n("el-button"),u=n("el-table-column"),K=n("el-tag"),G=n("el-table"),Q=n("el-pagination"),X=n("el-tab-pane"),ve=n("el-tabs"),g=n("el-form-item"),k=n("el-col"),Y=n("el-row"),ge=n("el-upload"),ee=n("el-form"),le=n("el-dialog"),ae=xe("loading");return V(),te("div",null,[s("div",Fe,[e[20]||(e[20]=s("div",null,[s("h1",{class:"page-title"},"SPD 资源管理"),s("p",{class:"page-subtitle"},"管理 Spreadtrum/UNISOC FDL1、FDL2 等资源")],-1)),s("div",Le,[l(b,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=a=>D.value=a),placeholder:"搜索芯片名、Chip ID...",style:{width:"220px"},onKeyup:ye(f,["enter"]),clearable:""},{prefix:t(()=>[l(y,null,{default:t(()=>[l(z(Ve))]),_:1})]),_:1},8,["modelValue"]),l(Z,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),placeholder:"资源类型",style:{width:"130px"},onChange:f,clearable:""},{default:t(()=>[l(m,{label:"全部类型",value:""}),l(m,{label:"FDL1",value:"fdl1"}),l(m,{label:"FDL2",value:"fdl2"}),l(m,{label:"Pac 包",value:"pac"}),l(m,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:ie,round:""},{default:t(()=>[l(y,null,{default:t(()=>[l(z(we))]),_:1}),e[19]||(e[19]=r(" 上传资源 ",-1))]),_:1})])]),x.value?(V(),te("div",Re,[s("div",Ie,[s("div",Pe,i(x.value.total_resources||0),1),e[21]||(e[21]=s("div",{class:"stat-label"},"资源总数",-1))]),s("div",Be,[s("div",Te,i(x.value.total_logs||0),1),e[22]||(e[22]=s("div",{class:"stat-label"},"设备日志",-1))]),s("div",$e,[s("div",je,i(x.value.today_logs||0),1),e[23]||(e[23]=s("div",{class:"stat-label"},"今日请求",-1))]),s("div",Ee,[s("div",Ne,i(x.value.total_downloads||0),1),e[24]||(e[24]=s("div",{class:"stat-label"},"总下载量",-1))])])):he("",!0),l(ve,{modelValue:H.value,"onUpdate:modelValue":e[6]||(e[6]=a=>H.value=a),onTabChange:ne},{default:t(()=>[l(X,{label:"资源列表",name:"resources"},{default:t(()=>[s("div",Me,[s("div",qe,[oe((V(),U(G,{data:A.value,stripe:"",style:{width:"100%"}},{default:t(()=>[l(u,{prop:"id",label:"ID",width:"70",align:"center"},{default:t(({row:a})=>[s("span",Ke,"#"+i(a.id),1)]),_:1}),l(u,{prop:"filename",label:"文件信息","min-width":"280"},{default:t(({row:a})=>[s("div",Oe,[s("span",Ae,i(a.filename),1),s("div",He,[l(K,{size:"small",type:"success"},{default:t(()=>[r(i(me(a.resource_type)),1)]),_:2},1024),s("span",Je,i(a.chip_name),1),s("span",We,i(fe(a.file_size)),1)])])]),_:1}),l(u,{prop:"chip_id",label:"Chip ID",width:"110"},{default:t(({row:a})=>[s("span",Ze,i(a.chip_id||"-"),1)]),_:1}),l(u,{prop:"is_enabled",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[s("span",{class:Ce(["status-badge",a.is_enabled?"enabled":"disabled"])},[e[25]||(e[25]=s("span",{class:"dot"},null,-1)),r(" "+i(a.is_enabled?"启用":"禁用"),1)],2)]),_:1}),l(u,{prop:"downloads",label:"下载",width:"80",align:"center"},{default:t(({row:a})=>[s("span",Ge,i(a.downloads||0),1)]),_:1}),l(u,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(({row:a})=>[l(v,{size:"small",onClick:O=>re(a),text:"",type:"primary"},{default:t(()=>[l(y,null,{default:t(()=>[l(z(ze))]),_:1}),e[26]||(e[26]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),a.is_enabled?(V(),U(v,{key:0,size:"small",onClick:O=>W(a,!1),text:"",type:"warning"},{default:t(()=>[...e[27]||(e[27]=[r("禁用",-1)])]),_:1},8,["onClick"])):(V(),U(v,{key:1,size:"small",onClick:O=>W(a,!0),text:"",type:"success"},{default:t(()=>[...e[28]||(e[28]=[r("启用",-1)])]),_:1},8,["onClick"])),l(v,{size:"small",onClick:O=>_e(a),text:"",type:"danger"},{default:t(()=>[l(y,null,{default:t(()=>[l(z(De))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,F.value]])]),s("div",Qe,[s("span",Xe,"共 "+i(L.value)+" 条记录",1),l(Q,{"current-page":R.value,"onUpdate:currentPage":e[2]||(e[2]=a=>R.value=a),"page-size":I.value,"onUpdate:pageSize":e[3]||(e[3]=a=>I.value=a),total:L.value,"page-sizes":[20,50,100],layout:"sizes, prev, pager, next",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])])]),_:1}),l(X,{label:"设备日志",name:"logs"},{default:t(()=>[s("div",Ye,[s("div",el,[oe((V(),U(G,{data:T.value,stripe:"",style:{width:"100%"}},{default:t(()=>[l(u,{prop:"id",label:"ID",width:"70",align:"center"}),l(u,{prop:"chip_id",label:"Chip ID",width:"100"},{default:t(({row:a})=>[s("code",ll,i(a.chip_id),1)]),_:1}),l(u,{prop:"chip_name",label:"芯片名称",width:"120"}),l(u,{prop:"secure_boot",label:"安全启动",width:"90",align:"center"},{default:t(({row:a})=>[l(K,{type:a.secure_boot==="true"||a.secure_boot==="1"?"danger":"success",size:"small"},{default:t(()=>[r(i(a.secure_boot==="true"||a.secure_boot==="1"?"开启":"关闭"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"fdl1_version",label:"FDL1",width:"100"}),l(u,{prop:"fdl2_version",label:"FDL2",width:"100"}),l(u,{prop:"match_result",label:"匹配结果",width:"100",align:"center"},{default:t(({row:a})=>[l(K,{type:a.match_result==="success"?"success":"info",size:"small"},{default:t(()=>[r(i(a.match_result),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"client_ip",label:"IP",width:"120"}),l(u,{prop:"created_at",label:"时间",width:"160"})]),_:1},8,["data"])),[[ae,B.value]])]),s("div",al,[l(Q,{"current-page":$.value,"onUpdate:currentPage":e[4]||(e[4]=a=>$.value=a),"page-size":j.value,"onUpdate:pageSize":e[5]||(e[5]=a=>j.value=a),total:J.value,"page-sizes":[20,50,100],layout:"sizes, prev, pager, next",onSizeChange:q,onCurrentChange:q},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=a=>w.value=a),title:"上传 SPD 资源",width:"550px"},{footer:t(()=>[l(v,{onClick:e[11]||(e[11]=a=>w.value=!1)},{default:t(()=>[...e[30]||(e[30]=[r("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:pe,loading:E.value},{default:t(()=>[...e[31]||(e[31]=[r("上传",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(ee,{model:p,"label-width":"100px"},{default:t(()=>[l(g,{label:"资源类型",required:""},{default:t(()=>[l(Z,{modelValue:p.resource_type,"onUpdate:modelValue":e[7]||(e[7]=a=>p.resource_type=a),style:{width:"100%"}},{default:t(()=>[l(m,{label:"FDL1",value:"fdl1"}),l(m,{label:"FDL2",value:"fdl2"}),l(m,{label:"Pac 包",value:"pac"}),l(m,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(Y,{gutter:20},{default:t(()=>[l(k,{span:12},{default:t(()=>[l(g,{label:"Chip ID"},{default:t(()=>[l(b,{modelValue:p.chip_id,"onUpdate:modelValue":e[8]||(e[8]=a=>p.chip_id=a),placeholder:"如 0x0616"},null,8,["modelValue"])]),_:1})]),_:1}),l(k,{span:12},{default:t(()=>[l(g,{label:"芯片名称"},{default:t(()=>[l(b,{modelValue:p.chip_name,"onUpdate:modelValue":e[9]||(e[9]=a=>p.chip_name=a),placeholder:"如 T616"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(g,{label:"描述"},{default:t(()=>[l(b,{modelValue:p.description,"onUpdate:modelValue":e[10]||(e[10]=a=>p.description=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(g,{label:"选择文件",required:""},{default:t(()=>[l(ge,{ref_key:"uploadRef",ref:de,"auto-upload":!1,limit:1,"on-change":ue,drag:""},{default:t(()=>[l(y,{class:"el-icon--upload"},{default:t(()=>[l(z(Se))]),_:1}),e[29]||(e[29]=s("div",{class:"el-upload__text"},[r("拖拽文件到这里或 "),s("em",null,"点击上传")],-1))]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(le,{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=a=>C.value=a),title:"编辑资源",width:"500px"},{footer:t(()=>[l(v,{onClick:e[17]||(e[17]=a=>C.value=!1)},{default:t(()=>[...e[32]||(e[32]=[r("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:ce,loading:N.value},{default:t(()=>[...e[33]||(e[33]=[r("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(ee,{model:c,"label-width":"100px"},{default:t(()=>[l(g,{label:"文件名"},{default:t(()=>[l(b,{modelValue:c.filename,"onUpdate:modelValue":e[13]||(e[13]=a=>c.filename=a),disabled:""},null,8,["modelValue"])]),_:1}),l(Y,{gutter:20},{default:t(()=>[l(k,{span:12},{default:t(()=>[l(g,{label:"Chip ID"},{default:t(()=>[l(b,{modelValue:c.chip_id,"onUpdate:modelValue":e[14]||(e[14]=a=>c.chip_id=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(k,{span:12},{default:t(()=>[l(g,{label:"芯片名称"},{default:t(()=>[l(b,{modelValue:c.chip_name,"onUpdate:modelValue":e[15]||(e[15]=a=>c.chip_name=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(g,{label:"描述"},{default:t(()=>[l(b,{modelValue:c.description,"onUpdate:modelValue":e[16]||(e[16]=a=>c.description=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},nl=Ue(tl,[["__scopeId","data-v-1531a87a"]]);export{nl as default};
