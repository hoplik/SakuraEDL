import{H as W,o as g,c as z,a as e,d as o,w as s,h as X,t as i,S as A,q as U,I as H,J as G,j as v,r as u,i as Y,T as Z,f,U as ee,K as te,b as c,M as oe,B as le,L as se,a0 as ae,a1 as ie,Q as ne,a2 as de,R as re,E as D}from"./index-CR8vSeWZ.js";const pe={class:"page-header"},ue={style:{display:"flex",gap:"12px"}},ce={style:{display:"grid","grid-template-columns":"repeat(5, 1fr)",gap:"16px","margin-bottom":"24px"}},fe={style:{background:"white",padding:"20px","border-radius":"12px","box-shadow":"0 2px 8px rgba(0,0,0,0.05)"}},_e={style:{display:"flex","align-items":"center",gap:"12px"}},ve={style:{width:"40px",height:"40px","border-radius":"10px",background:"rgba(102,126,234,0.1)",display:"flex","align-items":"center","justify-content":"center",color:"#667eea"}},ye={style:{"font-size":"24px","font-weight":"700",color:"#1e293b"}},ge={style:{background:"white",padding:"20px","border-radius":"12px","box-shadow":"0 2px 8px rgba(0,0,0,0.05)"}},me={style:{display:"flex","align-items":"center",gap:"12px"}},be={style:{width:"40px",height:"40px","border-radius":"10px",background:"rgba(16,185,129,0.1)",display:"flex","align-items":"center","justify-content":"center",color:"#10b981"}},he={style:{"font-size":"24px","font-weight":"700",color:"#10b981"}},xe={style:{background:"white",padding:"20px","border-radius":"12px","box-shadow":"0 2px 8px rgba(0,0,0,0.05)"}},we={style:{display:"flex","align-items":"center",gap:"12px"}},ke={style:{width:"40px",height:"40px","border-radius":"10px",background:"rgba(59,130,246,0.1)",display:"flex","align-items":"center","justify-content":"center",color:"#3b82f6"}},ze={style:{"font-size":"24px","font-weight":"700",color:"#3b82f6"}},Ve={style:{background:"white",padding:"20px","border-radius":"12px","box-shadow":"0 2px 8px rgba(0,0,0,0.05)"}},Ce={style:{display:"flex","align-items":"center",gap:"12px"}},De={style:{width:"40px",height:"40px","border-radius":"10px",background:"rgba(239,68,68,0.1)",display:"flex","align-items":"center","justify-content":"center",color:"#ef4444"}},Ie={style:{"font-size":"24px","font-weight":"700",color:"#ef4444"}},Me={style:{background:"white",padding:"20px","border-radius":"12px","box-shadow":"0 2px 8px rgba(0,0,0,0.05)"}},Se={style:{display:"flex","align-items":"center",gap:"12px"}},je={style:{width:"40px",height:"40px","border-radius":"10px",background:"rgba(245,158,11,0.1)",display:"flex","align-items":"center","justify-content":"center",color:"#f59e0b"}},Pe={style:{"font-size":"24px","font-weight":"700",color:"#f59e0b"}},Ue={class:"card"},Le={class:"card-body",style:{padding:"0"}},Oe={style:{"font-weight":"600",color:"#64748b"}},Te={style:{"font-weight":"500",color:"#1e293b"}},Ee={key:1,style:{color:"#94a3b8"}},Ke={style:{"font-family":"monospace","font-size":"12px",color:"#667eea","font-weight":"500"}},Re={style:{"font-family":"monospace","font-size":"11px",color:"#64748b"}},Be=["onClick"],He={style:{"font-family":"monospace","font-size":"11px",color:"#64748b"}},$e={style:{color:"#64748b","font-size":"12px"}},Ne={key:0,style:{"text-align":"center",padding:"60px",color:"#64748b"}},Fe={key:0,style:{"font-size":"14px"}},qe={style:{display:"grid","grid-template-columns":"120px 1fr",gap:"12px 16px","line-height":"1.8"}},Je={style:{"margin-left":"8px",color:"#94a3b8","font-size":"12px"}},Qe={style:{"font-weight":"600",color:"#1e293b"}},We={key:1},Xe={style:{"font-family":"monospace",color:"#667eea"}},Ae={style:{"font-family":"monospace"}},Ge={style:{"font-family":"monospace"}},Ye={style:{"font-family":"monospace","font-size":"12px","word-break":"break-all"}},Ze={style:{"font-family":"monospace"}},et={style:{"font-family":"monospace","font-size":"12px"}},tt={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"space-between","align-items":"center"}},ot={style:{"font-size":"13px",color:"#64748b"}},it={__name:"Logs",setup(lt){const x=v(!1),w=v([]),V=v(0),I=v(1),M=v(50),S=v(""),j=v(""),k=Y({matched:0,not_found:0,failed:0,today:0}),m=async()=>{x.value=!0;try{const a=await G.getLogs({page:I.value,page_size:M.value,keyword:S.value,result:j.value});a.code===0&&(w.value=a.data.list||[],V.value=a.data.total||0,a.data.stats&&Object.assign(k,a.data.stats))}catch(a){console.error("加载日志失败",a)}x.value=!1},L=a=>a==="success"?"success":a==="info_collected"?"primary":a==="not_found"?"warning":a==="failed"?"danger":"info",O=a=>({success:"连接成功",failed:"连接失败",info_collected:"信息收集",not_found:"未找到",matched:"匹配成功"})[a]||a,T=a=>a===3?"success":a===2?"primary":a===1?"warning":"info",E=a=>({Xiaomi:"warning",OnePlus:"danger",OPPO:"success",Realme:"",Samsung:"primary"})[a]||"info",C=v(!1),n=v(null),$=a=>{n.value=a,C.value=!0},K=a=>{if(!a)return"-";try{return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return a}},R=async a=>{try{await navigator.clipboard.writeText(a),D.success("已复制到剪贴板")}catch{D.error("复制失败")}},N=()=>{if(w.value.length===0){D.warning("暂无数据可导出");return}const a=["ID","平台","MSM ID","PK Hash","存储类型","结果","IP","时间"],t=w.value.map(r=>[r.id,r.platform||"",r.msm_id||"",r.pk_hash||"",r.storage_type||"",r.match_result||"",r.client_ip||"",r.created_at||""]),d=[a,...t].map(r=>r.map(b=>`"${b}"`).join(",")).join(`
`),P=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(P),_.download=`device_logs_${new Date().toISOString().slice(0,10)}.csv`,_.click(),D.success("导出成功")};return W(()=>{m()}),(a,t)=>{const d=u("el-icon"),P=u("el-input"),_=u("el-option"),r=u("el-select"),b=u("el-button"),p=u("el-table-column"),y=u("el-tag"),B=u("el-tooltip"),F=u("el-table"),q=u("el-dialog"),J=u("el-pagination"),Q=Z("loading");return g(),z("div",null,[e("div",pe,[t[9]||(t[9]=e("div",null,[e("h1",{class:"page-title"},"设备日志"),e("p",{class:"page-subtitle"},"查看设备匹配和下载记录")],-1)),e("div",ue,[o(P,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=l=>S.value=l),placeholder:"搜索 MSM ID / PK Hash...",style:{width:"240px"},onKeyup:X(m,["enter"]),clearable:""},{prefix:s(()=>[o(d,null,{default:s(()=>[o(f(ee))]),_:1})]),_:1},8,["modelValue"]),o(r,{modelValue:j.value,"onUpdate:modelValue":t[1]||(t[1]=l=>j.value=l),placeholder:"匹配结果",style:{width:"130px"},onChange:m,clearable:""},{default:s(()=>[o(_,{label:"全部结果",value:""}),o(_,{label:"连接成功",value:"success"}),o(_,{label:"连接失败",value:"failed"}),o(_,{label:"信息收集",value:"info_collected"}),o(_,{label:"未找到",value:"not_found"})]),_:1},8,["modelValue"]),o(b,{onClick:m,loading:x.value,round:""},{default:s(()=>[o(d,null,{default:s(()=>[o(f(te))]),_:1}),t[7]||(t[7]=c(" 刷新 ",-1))]),_:1},8,["loading"]),o(b,{onClick:N,round:""},{default:s(()=>[o(d,null,{default:s(()=>[o(f(oe))]),_:1}),t[8]||(t[8]=c(" 导出 ",-1))]),_:1})])]),e("div",ce,[e("div",fe,[e("div",_e,[e("div",ve,[o(d,{size:"20"},{default:s(()=>[o(f(le))]),_:1})]),e("div",null,[t[10]||(t[10]=e("div",{style:{"font-size":"12px",color:"#64748b"}},"总请求数",-1)),e("div",ye,i(V.value),1)])])]),e("div",ge,[e("div",me,[e("div",be,[o(d,{size:"20"},{default:s(()=>[o(f(se))]),_:1})]),e("div",null,[t[11]||(t[11]=e("div",{style:{"font-size":"12px",color:"#64748b"}},"连接成功",-1)),e("div",he,i(k.success||0),1)])])]),e("div",xe,[e("div",we,[e("div",ke,[o(d,{size:"20"},{default:s(()=>[o(f(ae))]),_:1})]),e("div",null,[t[12]||(t[12]=e("div",{style:{"font-size":"12px",color:"#64748b"}},"信息收集",-1)),e("div",ze,i(k.info_collected||0),1)])])]),e("div",Ve,[e("div",Ce,[e("div",De,[o(d,{size:"20"},{default:s(()=>[o(f(ie))]),_:1})]),e("div",null,[t[13]||(t[13]=e("div",{style:{"font-size":"12px",color:"#64748b"}},"连接失败",-1)),e("div",Ie,i(k.failed||0),1)])])]),e("div",Me,[e("div",Se,[e("div",je,[o(d,{size:"20"},{default:s(()=>[o(f(ne))]),_:1})]),e("div",null,[t[14]||(t[14]=e("div",{style:{"font-size":"12px",color:"#64748b"}},"今日请求",-1)),e("div",Pe,i(k.today||0),1)])])])]),e("div",Ue,[e("div",Le,[A((g(),U(F,{data:w.value,stripe:"",style:{width:"100%"}},{default:s(()=>[o(p,{prop:"id",label:"ID",width:"60",align:"center"},{default:s(({row:l})=>[e("span",Oe,"#"+i(l.id),1)]),_:1}),o(p,{prop:"sahara_version",label:"协议",width:"70",align:"center"},{default:s(({row:l})=>[o(y,{type:T(l.sahara_version),size:"small",effect:"plain"},{default:s(()=>[c(" V"+i(l.sahara_version||"?"),1)]),_:2},1032,["type"])]),_:1}),o(p,{prop:"chip_name",label:"芯片",width:"100"},{default:s(({row:l})=>[e("span",Te,i(l.chip_name||"-"),1)]),_:1}),o(p,{prop:"vendor",label:"厂商",width:"90"},{default:s(({row:l})=>[l.vendor?(g(),U(y,{key:0,size:"small",type:E(l.vendor),effect:"plain"},{default:s(()=>[c(i(l.vendor),1)]),_:2},1032,["type"])):(g(),z("span",Ee,"-"))]),_:1}),o(p,{prop:"msm_id",label:"MSM ID",width:"100"},{default:s(({row:l})=>[e("span",Ke,i(l.msm_id||"-"),1)]),_:1}),o(p,{prop:"oem_id",label:"OEM",width:"70",align:"center"},{default:s(({row:l})=>[e("span",Re,i(l.oem_id||"-"),1)]),_:1}),o(p,{prop:"pk_hash",label:"PK Hash","min-width":"200"},{default:s(({row:l})=>[o(B,{content:l.pk_hash,placement:"top","show-after":500},{default:s(()=>{var h;return[e("span",{style:{"font-family":"monospace","font-size":"11px",color:"#64748b",cursor:"pointer"},onClick:st=>R(l.pk_hash)},i((h=l.pk_hash)==null?void 0:h.substring(0,32))+"... ",9,Be)]}),_:2},1032,["content"])]),_:1}),o(p,{prop:"storage_type",label:"存储",width:"70",align:"center"},{default:s(({row:l})=>[o(y,{size:"small",type:"info",effect:"plain"},{default:s(()=>{var h;return[c(i(((h=l.storage_type)==null?void 0:h.toUpperCase())||"-"),1)]}),_:2},1024)]),_:1}),o(p,{prop:"match_result",label:"结果",width:"90",align:"center"},{default:s(({row:l})=>[o(y,{type:L(l.match_result),size:"small",effect:"dark"},{default:s(()=>[c(i(O(l.match_result)),1)]),_:2},1032,["type"])]),_:1}),o(p,{prop:"client_ip",label:"IP",width:"120"},{default:s(({row:l})=>[e("span",He,i(l.client_ip||"-"),1)]),_:1}),o(p,{prop:"created_at",label:"时间",width:"160"},{default:s(({row:l})=>[e("span",$e,i(K(l.created_at)),1)]),_:1}),o(p,{label:"",width:"50",align:"center"},{default:s(({row:l})=>[o(B,{content:"查看详情",placement:"top"},{default:s(()=>[o(b,{link:"",onClick:h=>$(l)},{default:s(()=>[o(d,null,{default:s(()=>[o(f(de))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,x.value]]),w.value.length===0&&!x.value?(g(),z("div",Ne,[o(d,{style:{"font-size":"56px","margin-bottom":"16px",color:"#cbd5e1"}},{default:s(()=>[o(f(re))]),_:1}),t[15]||(t[15]=e("p",{style:{"font-size":"15px"}},"暂无日志记录",-1)),t[16]||(t[16]=e("p",{style:{"font-size":"13px",color:"#94a3b8","margin-top":"8px"}},"设备匹配请求将显示在这里",-1))])):H("",!0)]),o(q,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=l=>C.value=l),title:"设备详情",width:"600px"},{footer:s(()=>[o(b,{onClick:t[3]||(t[3]=l=>C.value=!1)},{default:s(()=>[...t[30]||(t[30]=[c("关闭",-1)])]),_:1})]),default:s(()=>[n.value?(g(),z("div",Fe,[e("div",qe,[t[17]||(t[17]=e("div",{style:{color:"#64748b","font-weight":"500"}},"Sahara 协议",-1)),e("div",null,[o(y,{type:T(n.value.sahara_version),size:"small"},{default:s(()=>[c(" V"+i(n.value.sahara_version||"?"),1)]),_:1},8,["type"]),e("span",Je,i(n.value.sahara_version===3?"(V3 扩展信息)":n.value.sahara_version===2?"(V2 标准)":n.value.sahara_version===1?"(V1 旧版)":""),1)]),t[18]||(t[18]=e("div",{style:{color:"#64748b","font-weight":"500"}},"芯片名称",-1)),e("div",Qe,i(n.value.chip_name||"-"),1),t[19]||(t[19]=e("div",{style:{color:"#64748b","font-weight":"500"}},"厂商",-1)),e("div",null,[n.value.vendor?(g(),U(y,{key:0,type:E(n.value.vendor),size:"small"},{default:s(()=>[c(i(n.value.vendor),1)]),_:1},8,["type"])):(g(),z("span",We,"-"))]),t[20]||(t[20]=e("div",{style:{color:"#64748b","font-weight":"500"}},"MSM ID",-1)),e("div",Xe,i(n.value.msm_id||"-"),1),t[21]||(t[21]=e("div",{style:{color:"#64748b","font-weight":"500"}},"OEM ID",-1)),e("div",Ae,i(n.value.oem_id||"-"),1),t[22]||(t[22]=e("div",{style:{color:"#64748b","font-weight":"500"}},"Model ID",-1)),e("div",Ge,i(n.value.model_id||"-"),1),t[23]||(t[23]=e("div",{style:{color:"#64748b","font-weight":"500"}},"HW ID",-1)),e("div",Ye,i(n.value.hw_id||"-"),1),t[24]||(t[24]=e("div",{style:{color:"#64748b","font-weight":"500"}},"序列号",-1)),e("div",Ze,i(n.value.serial_number||"-"),1),t[25]||(t[25]=e("div",{style:{color:"#64748b","font-weight":"500"}},"PK Hash",-1)),e("div",{style:{"font-family":"monospace","font-size":"11px","word-break":"break-all",cursor:"pointer",color:"#64748b"},onClick:t[2]||(t[2]=l=>R(n.value.pk_hash))},i(n.value.pk_hash||"-"),1),t[26]||(t[26]=e("div",{style:{color:"#64748b","font-weight":"500"}},"存储类型",-1)),e("div",null,[o(y,{size:"small",type:"info"},{default:s(()=>{var l;return[c(i(((l=n.value.storage_type)==null?void 0:l.toUpperCase())||"-"),1)]}),_:1})]),t[27]||(t[27]=e("div",{style:{color:"#64748b","font-weight":"500"}},"结果",-1)),e("div",null,[o(y,{type:L(n.value.match_result),size:"small",effect:"dark"},{default:s(()=>[c(i(O(n.value.match_result)),1)]),_:1},8,["type"])]),t[28]||(t[28]=e("div",{style:{color:"#64748b","font-weight":"500"}},"客户端 IP",-1)),e("div",et,i(n.value.client_ip||"-"),1),t[29]||(t[29]=e("div",{style:{color:"#64748b","font-weight":"500"}},"时间",-1)),e("div",null,i(K(n.value.created_at)),1)])])):H("",!0)]),_:1},8,["modelValue"]),e("div",tt,[e("span",ot,"共 "+i(V.value)+" 条记录",1),o(J,{"current-page":I.value,"onUpdate:currentPage":t[5]||(t[5]=l=>I.value=l),"page-size":M.value,"onUpdate:pageSize":t[6]||(t[6]=l=>M.value=l),total:V.value,"page-sizes":[50,100,200],layout:"sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])])])])}}};export{it as default};
