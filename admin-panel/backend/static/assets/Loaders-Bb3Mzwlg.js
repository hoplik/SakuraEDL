import{H as Q,o as h,c as P,a as n,d as e,w as a,h as R,S as ee,q as j,t as i,J as k,j as m,r as d,T as le,f as v,U as te,V as ae,b as u,p as F,M as oe,N as ne,W as se,X as de,Y as ie,Z as ue,E as y,_ as pe,i as re}from"./index-CR8vSeWZ.js";const fe={class:"page-header"},_e={style:{display:"flex",gap:"12px"}},me={class:"card"},ce={class:"card-body",style:{padding:"0"}},ge={style:{"font-weight":"600",color:"#64748b"}},ve={style:{display:"flex","flex-direction":"column",gap:"4px"}},ye={style:{"font-weight":"600",color:"#1e293b"}},be={style:{display:"flex",gap:"8px","align-items":"center"}},Ve={style:{color:"#64748b","font-size":"12px"}},xe={style:{color:"#94a3b8","font-size":"11px"}},he={style:{"font-family":"monospace","font-size":"12px",color:"#64748b"}},we={key:0,style:{display:"flex",gap:"4px","justify-content":"center"}},ke={key:1,style:{color:"#cbd5e1"}},ze={style:{"font-size":"12px",color:"#64748b"}},Ce={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"space-between","align-items":"center"}},Le={style:{"font-size":"13px",color:"#64748b"}},Se={__name:"Loaders",setup(Ue){const C=m(!1),H=m([]),L=m(0),U=m(1),D=m(20),S=m(""),B=m(""),w=m(!1),I=m(!1),s=re({}),c=async()=>{C.value=!0;try{const o=await k.getLoaders({page:U.value,page_size:D.value,keyword:S.value,auth_type:B.value});o.code===0&&(H.value=o.data.list||[],L.value=o.data.total||0)}catch(o){console.error("加载列表失败",o)}C.value=!1},N=o=>{Object.assign(s,o),w.value=!0},T=async()=>{I.value=!0;try{const o=await k.updateLoader(s.id,s);o.code===0?(y.success("保存成功"),w.value=!1,c()):y.error(o.message||"保存失败")}catch{y.error("保存失败")}I.value=!1},K=async(o,l)=>{try{(l?await k.enableLoader(o.id):await k.disableLoader(o.id)).code===0&&(y.success(l?"已启用":"已禁用"),c())}catch{y.error("操作失败")}},W=async o=>{try{await pe.confirm(`确定要删除 "${o.filename}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"});const l=await k.deleteLoader(o.id);l.code===0?(y.success("删除成功"),c()):y.error(l.message||"删除失败")}catch(l){l!=="cancel"&&y.error("删除失败")}},O=o=>o<1024?o+" B":o<1024*1024?(o/1024).toFixed(1)+" KB":(o/1024/1024).toFixed(2)+" MB",q=o=>({none:"无验证",miauth:"小米",demacia:"一加",vip:"VIP"})[o]||o,A=o=>{if(!o)return"";const l=o.toLowerCase();return l.includes("xiaomi")||l.includes("redmi")||l.includes("poco")?"xiaomi":l.includes("oplus")||l.includes("oneplus")||l.includes("oppo")||l.includes("realme")?"oplus":l.includes("samsung")?"samsung":l.includes("huawei")||l.includes("honor")?"huawei":""};return Q(()=>{c()}),(o,l)=>{const r=d("el-icon"),g=d("el-input"),p=d("el-option"),M=d("el-select"),b=d("el-button"),f=d("el-table-column"),$=d("el-tag"),z=d("el-tooltip"),J=d("el-table"),X=d("el-pagination"),_=d("el-form-item"),V=d("el-col"),E=d("el-row"),Y=d("el-form"),Z=d("el-dialog"),G=le("loading");return h(),P("div",null,[n("div",fe,[l[17]||(l[17]=n("div",null,[n("h1",{class:"page-title"},"Loader 管理"),n("p",{class:"page-subtitle"},"管理所有已上传的 Loader 文件")],-1)),n("div",_e,[e(g,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=t=>S.value=t),placeholder:"搜索文件名、芯片...",style:{width:"220px"},onKeyup:R(c,["enter"]),clearable:""},{prefix:a(()=>[e(r,null,{default:a(()=>[e(v(te))]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:B.value,"onUpdate:modelValue":l[1]||(l[1]=t=>B.value=t),placeholder:"验证类型",style:{width:"130px"},onChange:c,clearable:""},{default:a(()=>[e(p,{label:"全部类型",value:""}),e(p,{label:"无验证",value:"none"}),e(p,{label:"小米验证",value:"miauth"}),e(p,{label:"一加验证",value:"demacia"}),e(p,{label:"VIP 验证",value:"vip"})]),_:1},8,["modelValue"]),e(b,{type:"primary",onClick:l[2]||(l[2]=t=>o.$router.push("/upload")),round:""},{default:a(()=>[e(r,null,{default:a(()=>[e(v(ae))]),_:1}),l[16]||(l[16]=u(" 上传新 Loader ",-1))]),_:1})])]),n("div",me,[n("div",ce,[ee((h(),j(J,{data:H.value,stripe:"",style:{width:"100%"}},{default:a(()=>[e(f,{prop:"id",label:"ID",width:"70",align:"center"},{default:a(({row:t})=>[n("span",ge,"#"+i(t.id),1)]),_:1}),e(f,{prop:"filename",label:"文件信息","min-width":"280"},{default:a(({row:t})=>[n("div",ve,[n("span",ye,i(t.filename),1),n("div",be,[n("span",{class:F(["vendor-badge",A(t.vendor)])},i(t.vendor||"未知"),3),n("span",Ve,i(t.chip),1),n("span",xe,i(O(t.file_size)),1)])])]),_:1}),e(f,{prop:"hw_id",label:"HW ID",width:"110"},{default:a(({row:t})=>[n("span",he,i(t.hw_id||"-"),1)]),_:1}),e(f,{prop:"auth_type",label:"验证",width:"100",align:"center"},{default:a(({row:t})=>[n("span",{class:F(["auth-tag",t.auth_type])},i(q(t.auth_type)),3)]),_:1}),e(f,{prop:"storage_type",label:"存储",width:"80",align:"center"},{default:a(({row:t})=>[e($,{size:"small",type:"info",effect:"plain"},{default:a(()=>{var x;return[u(i((x=t.storage_type)==null?void 0:x.toUpperCase()),1)]}),_:2},1024)]),_:1}),e(f,{label:"VIP",width:"80",align:"center"},{default:a(({row:t})=>[t.auth_type==="vip"?(h(),P("div",we,[e(z,{content:"Digest 文件",placement:"top"},{default:a(()=>[e($,{size:"small",type:t.has_digest?"success":"danger",effect:"dark"},{default:a(()=>[...l[18]||(l[18]=[u("D",-1)])]),_:1},8,["type"])]),_:2},1024),e(z,{content:"Sign 文件",placement:"top"},{default:a(()=>[e($,{size:"small",type:t.has_sign?"success":"danger",effect:"dark"},{default:a(()=>[...l[19]||(l[19]=[u("S",-1)])]),_:1},8,["type"])]),_:2},1024)])):(h(),P("span",ke,"-"))]),_:1}),e(f,{prop:"is_enabled",label:"状态",width:"90",align:"center"},{default:a(({row:t})=>[n("span",{class:F(["status-badge",t.is_enabled?"enabled":"disabled"])},[l[20]||(l[20]=n("span",{class:"dot"},null,-1)),u(" "+i(t.is_enabled?"启用":"禁用"),1)],2)]),_:1}),e(f,{label:"统计",width:"100",align:"center"},{default:a(({row:t})=>[n("div",ze,[e(z,{content:"下载次数",placement:"top"},{default:a(()=>[n("span",null,[e(r,null,{default:a(()=>[e(v(oe))]),_:1}),u(" "+i(t.downloads||0),1)])]),_:2},1024),l[21]||(l[21]=n("span",{style:{margin:"0 6px",color:"#e2e8f0"}},"|",-1)),e(z,{content:"匹配次数",placement:"top"},{default:a(()=>[n("span",null,[e(r,null,{default:a(()=>[e(v(ne))]),_:1}),u(" "+i(t.match_count||0),1)])]),_:2},1024)])]),_:1}),e(f,{label:"操作",width:"200",fixed:"right",align:"center"},{default:a(({row:t})=>[e(b,{size:"small",onClick:x=>N(t),text:"",type:"primary"},{default:a(()=>[e(r,null,{default:a(()=>[e(v(se))]),_:1}),l[22]||(l[22]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),t.is_enabled?(h(),j(b,{key:0,size:"small",onClick:x=>K(t,!1),text:"",type:"warning"},{default:a(()=>[e(r,null,{default:a(()=>[e(v(de))]),_:1}),l[23]||(l[23]=u(" 禁用 ",-1))]),_:1},8,["onClick"])):(h(),j(b,{key:1,size:"small",onClick:x=>K(t,!0),text:"",type:"success"},{default:a(()=>[e(r,null,{default:a(()=>[e(v(ie))]),_:1}),l[24]||(l[24]=u(" 启用 ",-1))]),_:1},8,["onClick"])),e(b,{size:"small",onClick:x=>W(t),text:"",type:"danger"},{default:a(()=>[e(r,null,{default:a(()=>[e(v(ue))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,C.value]])]),n("div",Ce,[n("span",Le,"共 "+i(L.value)+" 条记录",1),e(X,{"current-page":U.value,"onUpdate:currentPage":l[3]||(l[3]=t=>U.value=t),"page-size":D.value,"onUpdate:pageSize":l[4]||(l[4]=t=>D.value=t),total:L.value,"page-sizes":[20,50,100],layout:"sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])]),e(Z,{modelValue:w.value,"onUpdate:modelValue":l[15]||(l[15]=t=>w.value=t),title:"编辑 Loader",width:"600px"},{footer:a(()=>[e(b,{onClick:l[14]||(l[14]=t=>w.value=!1)},{default:a(()=>[...l[25]||(l[25]=[u("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:T,loading:I.value},{default:a(()=>[...l[26]||(l[26]=[u("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(Y,{model:s,"label-width":"100px"},{default:a(()=>[e(_,{label:"文件名"},{default:a(()=>[e(g,{modelValue:s.filename,"onUpdate:modelValue":l[5]||(l[5]=t=>s.filename=t),disabled:""},null,8,["modelValue"])]),_:1}),e(E,{gutter:20},{default:a(()=>[e(V,{span:12},{default:a(()=>[e(_,{label:"厂商"},{default:a(()=>[e(g,{modelValue:s.vendor,"onUpdate:modelValue":l[6]||(l[6]=t=>s.vendor=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:a(()=>[e(_,{label:"芯片"},{default:a(()=>[e(g,{modelValue:s.chip,"onUpdate:modelValue":l[7]||(l[7]=t=>s.chip=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(V,{span:12},{default:a(()=>[e(_,{label:"HW ID"},{default:a(()=>[e(g,{modelValue:s.hw_id,"onUpdate:modelValue":l[8]||(l[8]=t=>s.hw_id=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:a(()=>[e(_,{label:"OEM ID"},{default:a(()=>[e(g,{modelValue:s.oem_id,"onUpdate:modelValue":l[9]||(l[9]=t=>s.oem_id=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{label:"PK Hash"},{default:a(()=>[e(g,{modelValue:s.pk_hash,"onUpdate:modelValue":l[10]||(l[10]=t=>s.pk_hash=t)},null,8,["modelValue"])]),_:1}),e(E,{gutter:20},{default:a(()=>[e(V,{span:12},{default:a(()=>[e(_,{label:"验证类型"},{default:a(()=>[e(M,{modelValue:s.auth_type,"onUpdate:modelValue":l[11]||(l[11]=t=>s.auth_type=t),style:{width:"100%"}},{default:a(()=>[e(p,{label:"无验证",value:"none"}),e(p,{label:"小米验证",value:"miauth"}),e(p,{label:"一加验证",value:"demacia"}),e(p,{label:"VIP 验证",value:"vip"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:a(()=>[e(_,{label:"存储类型"},{default:a(()=>[e(M,{modelValue:s.storage_type,"onUpdate:modelValue":l[12]||(l[12]=t=>s.storage_type=t),style:{width:"100%"}},{default:a(()=>[e(p,{label:"UFS",value:"ufs"}),e(p,{label:"eMMC",value:"emmc"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{label:"备注"},{default:a(()=>[e(g,{modelValue:s.notes,"onUpdate:modelValue":l[13]||(l[13]=t=>s.notes=t),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{Se as default};
