import{H as be,o as y,c as N,a as s,d as e,w as t,h as ye,t as u,I as he,J as w,j as d,r as i,T as we,f as z,U as Ve,x as xe,b as _,S as oe,q as C,p as ke,W as ze,Z as Ce,$ as Ue,E as f,_ as Me,i as se}from"./index-CR8vSeWZ.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"page-header"},Re={style:{display:"flex",gap:"12px"}},Ae={key:0,class:"stats-row"},Fe={class:"stat-card"},Se={class:"stat-value"},Te={class:"stat-card"},Be={class:"stat-value"},Pe={class:"stat-card"},Xe={class:"stat-value"},$e={class:"stat-card"},He={class:"stat-value"},We={class:"card"},je={class:"card-body",style:{padding:"0"}},Ee={style:{"font-weight":"600",color:"#64748b"}},Ie={style:{display:"flex","flex-direction":"column",gap:"4px"}},Ke={style:{"font-weight":"600",color:"#1e293b"}},Ne={style:{display:"flex",gap:"8px","align-items":"center"}},qe={style:{color:"#64748b","font-size":"12px"}},Oe={style:{color:"#94a3b8","font-size":"11px"}},Je={style:{"font-family":"monospace","font-size":"12px",color:"#64748b"}},Ze={key:1,style:{color:"#cbd5e1"}},Ge={style:{"font-size":"13px",color:"#64748b"}},Qe={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"space-between","align-items":"center"}},Ye={style:{"font-size":"13px",color:"#64748b"}},el={class:"card"},ll={class:"card-body",style:{padding:"0"}},al={style:{"font-size":"12px"}},tl={class:"card-body",style:{"border-top":"1px solid #f1f5f9",display:"flex","justify-content":"flex-end"}},ol={__name:"MtkResources",setup(sl){const A=d(!1),q=d([]),F=d(0),S=d(1),T=d(20),U=d(""),B=d(""),O=d("resources"),V=d({}),P=d(!1),X=d([]),J=d(0),$=d(1),H=d(20),x=d(!1),W=d(!1),de=d(),M=d(null),n=se({resource_type:"da",hw_code:"",chip_name:"",da_mode:"",description:""}),k=d(!1),j=d(!1),c=se({}),v=async()=>{A.value=!0;try{const o=await w.getMtkResources({page:S.value,page_size:T.value,keyword:U.value,type:B.value});o.code===0&&(q.value=o.data.resources||[],F.value=o.data.total||0)}catch(o){console.error("加载列表失败",o)}A.value=!1},E=async()=>{try{const o=await w.getMtkStats();o.code===0&&(V.value=o.data)}catch(o){console.error("加载统计失败",o)}},I=async()=>{P.value=!0;try{const o=await w.getMtkLogs({page:$.value,page_size:H.value,keyword:U.value});o.code===0&&(X.value=o.data.logs||[],J.value=o.data.total||0)}catch(o){console.error("加载日志失败",o)}P.value=!1},ne=o=>{o==="logs"&&X.value.length===0&&I()},ue=()=>{Object.assign(n,{resource_type:"da",hw_code:"",chip_name:"",da_mode:"",description:""}),M.value=null,x.value=!0},ie=o=>{M.value=o.raw},re=async()=>{if(!M.value){f.warning("请选择文件");return}W.value=!0;try{const o=new FormData;o.append("file",M.value),o.append("resource_type",n.resource_type),o.append("hw_code",n.hw_code),o.append("chip_name",n.chip_name),o.append("da_mode",n.da_mode),o.append("description",n.description);const l=await w.uploadMtkResource(o);l.code===0?(f.success("上传成功"),x.value=!1,v(),E()):f.error(l.message||"上传失败")}catch{f.error("上传失败")}W.value=!1},pe=o=>{Object.assign(c,o),k.value=!0},ce=async()=>{j.value=!0;try{const o=await w.updateMtkResource(c.id,c);o.code===0?(f.success("保存成功"),k.value=!1,v()):f.error(o.message||"保存失败")}catch{f.error("保存失败")}j.value=!1},Z=async(o,l)=>{try{(await w.updateMtkResource(o.id,{is_enabled:l})).code===0&&(f.success(l?"已启用":"已禁用"),v())}catch{f.error("操作失败")}},_e=async o=>{try{await Me.confirm(`确定要删除 "${o.filename}" 吗？`,"确认删除",{type:"warning"});const l=await w.deleteMtkResource(o.id);l.code===0?(f.success("删除成功"),v(),E()):f.error(l.message||"删除失败")}catch(l){l!=="cancel"&&f.error("删除失败")}},fe=o=>o?o<1024?o+" B":o<1024*1024?(o/1024).toFixed(1)+" KB":(o/1024/1024).toFixed(2)+" MB":"-",me=o=>({da:"DA",auth:"Auth",preloader:"Preloader",other:"其他"})[o]||o;return be(()=>{v(),E()}),(o,l)=>{const h=i("el-icon"),b=i("el-input"),r=i("el-option"),D=i("el-select"),g=i("el-button"),p=i("el-table-column"),L=i("el-tag"),G=i("el-table"),Q=i("el-pagination"),Y=i("el-tab-pane"),ve=i("el-tabs"),m=i("el-form-item"),R=i("el-col"),ee=i("el-row"),ge=i("el-upload"),le=i("el-form"),ae=i("el-dialog"),te=we("loading");return y(),N("div",null,[s("div",Le,[l[22]||(l[22]=s("div",null,[s("h1",{class:"page-title"},"MTK 资源管理"),s("p",{class:"page-subtitle"},"管理 MediaTek DA 文件、Auth 文件等资源")],-1)),s("div",Re,[e(b,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=a=>U.value=a),placeholder:"搜索芯片名、HW Code...",style:{width:"220px"},onKeyup:ye(v,["enter"]),clearable:""},{prefix:t(()=>[e(h,null,{default:t(()=>[e(z(Ve))]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:B.value,"onUpdate:modelValue":l[1]||(l[1]=a=>B.value=a),placeholder:"资源类型",style:{width:"130px"},onChange:v,clearable:""},{default:t(()=>[e(r,{label:"全部类型",value:""}),e(r,{label:"DA 文件",value:"da"}),e(r,{label:"Auth 文件",value:"auth"}),e(r,{label:"Preloader",value:"preloader"}),e(r,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),e(g,{type:"primary",onClick:ue,round:""},{default:t(()=>[e(h,null,{default:t(()=>[e(z(xe))]),_:1}),l[21]||(l[21]=_(" 上传资源 ",-1))]),_:1})])]),V.value?(y(),N("div",Ae,[s("div",Fe,[s("div",Se,u(V.value.total_resources||0),1),l[23]||(l[23]=s("div",{class:"stat-label"},"资源总数",-1))]),s("div",Te,[s("div",Be,u(V.value.total_logs||0),1),l[24]||(l[24]=s("div",{class:"stat-label"},"设备日志",-1))]),s("div",Pe,[s("div",Xe,u(V.value.today_logs||0),1),l[25]||(l[25]=s("div",{class:"stat-label"},"今日请求",-1))]),s("div",$e,[s("div",He,u(V.value.total_downloads||0),1),l[26]||(l[26]=s("div",{class:"stat-label"},"总下载量",-1))])])):he("",!0),e(ve,{modelValue:O.value,"onUpdate:modelValue":l[6]||(l[6]=a=>O.value=a),onTabChange:ne},{default:t(()=>[e(Y,{label:"资源列表",name:"resources"},{default:t(()=>[s("div",We,[s("div",je,[oe((y(),C(G,{data:q.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(p,{prop:"id",label:"ID",width:"70",align:"center"},{default:t(({row:a})=>[s("span",Ee,"#"+u(a.id),1)]),_:1}),e(p,{prop:"filename",label:"文件信息","min-width":"280"},{default:t(({row:a})=>[s("div",Ie,[s("span",Ke,u(a.filename),1),s("div",Ne,[e(L,{size:"small",type:"warning"},{default:t(()=>[_(u(me(a.resource_type)),1)]),_:2},1024),s("span",qe,u(a.chip_name),1),s("span",Oe,u(fe(a.file_size)),1)])])]),_:1}),e(p,{prop:"hw_code",label:"HW Code",width:"110"},{default:t(({row:a})=>[s("span",Je,u(a.hw_code||"-"),1)]),_:1}),e(p,{prop:"da_mode",label:"DA 模式",width:"100",align:"center"},{default:t(({row:a})=>[a.da_mode?(y(),C(L,{key:0,size:"small",type:"info"},{default:t(()=>[_(u(a.da_mode),1)]),_:2},1024)):(y(),N("span",Ze,"-"))]),_:1}),e(p,{prop:"is_enabled",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[s("span",{class:ke(["status-badge",a.is_enabled?"enabled":"disabled"])},[l[27]||(l[27]=s("span",{class:"dot"},null,-1)),_(" "+u(a.is_enabled?"启用":"禁用"),1)],2)]),_:1}),e(p,{prop:"downloads",label:"下载",width:"80",align:"center"},{default:t(({row:a})=>[s("span",Ge,u(a.downloads||0),1)]),_:1}),e(p,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(({row:a})=>[e(g,{size:"small",onClick:K=>pe(a),text:"",type:"primary"},{default:t(()=>[e(h,null,{default:t(()=>[e(z(ze))]),_:1}),l[28]||(l[28]=_(" 编辑 ",-1))]),_:1},8,["onClick"]),a.is_enabled?(y(),C(g,{key:0,size:"small",onClick:K=>Z(a,!1),text:"",type:"warning"},{default:t(()=>[...l[29]||(l[29]=[_("禁用",-1)])]),_:1},8,["onClick"])):(y(),C(g,{key:1,size:"small",onClick:K=>Z(a,!0),text:"",type:"success"},{default:t(()=>[...l[30]||(l[30]=[_("启用",-1)])]),_:1},8,["onClick"])),e(g,{size:"small",onClick:K=>_e(a),text:"",type:"danger"},{default:t(()=>[e(h,null,{default:t(()=>[e(z(Ce))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,A.value]])]),s("div",Qe,[s("span",Ye,"共 "+u(F.value)+" 条记录",1),e(Q,{"current-page":S.value,"onUpdate:currentPage":l[2]||(l[2]=a=>S.value=a),"page-size":T.value,"onUpdate:pageSize":l[3]||(l[3]=a=>T.value=a),total:F.value,"page-sizes":[20,50,100],layout:"sizes, prev, pager, next",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])])]),_:1}),e(Y,{label:"设备日志",name:"logs"},{default:t(()=>[s("div",el,[s("div",ll,[oe((y(),C(G,{data:X.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(p,{prop:"id",label:"ID",width:"70",align:"center"}),e(p,{prop:"hw_code",label:"HW Code",width:"100"},{default:t(({row:a})=>[s("code",al,u(a.hw_code),1)]),_:1}),e(p,{prop:"chip_name",label:"芯片名称",width:"120"}),e(p,{prop:"secure_boot",label:"安全启动",width:"90",align:"center"},{default:t(({row:a})=>[e(L,{type:a.secure_boot==="true"||a.secure_boot==="1"?"danger":"success",size:"small"},{default:t(()=>[_(u(a.secure_boot==="true"||a.secure_boot==="1"?"开启":"关闭"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"da_mode",label:"DA 模式",width:"90"}),e(p,{prop:"match_result",label:"匹配结果",width:"100",align:"center"},{default:t(({row:a})=>[e(L,{type:a.match_result==="success"?"success":"info",size:"small"},{default:t(()=>[_(u(a.match_result),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"client_ip",label:"IP",width:"120"}),e(p,{prop:"created_at",label:"时间",width:"160"})]),_:1},8,["data"])),[[te,P.value]])]),s("div",tl,[e(Q,{"current-page":$.value,"onUpdate:currentPage":l[4]||(l[4]=a=>$.value=a),"page-size":H.value,"onUpdate:pageSize":l[5]||(l[5]=a=>H.value=a),total:J.value,"page-sizes":[20,50,100],layout:"sizes, prev, pager, next",onSizeChange:I,onCurrentChange:I},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"]),e(ae,{modelValue:x.value,"onUpdate:modelValue":l[13]||(l[13]=a=>x.value=a),title:"上传 MTK 资源",width:"550px"},{footer:t(()=>[e(g,{onClick:l[12]||(l[12]=a=>x.value=!1)},{default:t(()=>[...l[32]||(l[32]=[_("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:re,loading:W.value},{default:t(()=>[...l[33]||(l[33]=[_("上传",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(le,{model:n,"label-width":"100px"},{default:t(()=>[e(m,{label:"资源类型",required:""},{default:t(()=>[e(D,{modelValue:n.resource_type,"onUpdate:modelValue":l[7]||(l[7]=a=>n.resource_type=a),style:{width:"100%"}},{default:t(()=>[e(r,{label:"DA 文件",value:"da"}),e(r,{label:"Auth 文件",value:"auth"}),e(r,{label:"Preloader",value:"preloader"}),e(r,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(ee,{gutter:20},{default:t(()=>[e(R,{span:12},{default:t(()=>[e(m,{label:"HW Code"},{default:t(()=>[e(b,{modelValue:n.hw_code,"onUpdate:modelValue":l[8]||(l[8]=a=>n.hw_code=a),placeholder:"如 0x0717"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:12},{default:t(()=>[e(m,{label:"芯片名称"},{default:t(()=>[e(b,{modelValue:n.chip_name,"onUpdate:modelValue":l[9]||(l[9]=a=>n.chip_name=a),placeholder:"如 MT6765"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"DA 模式"},{default:t(()=>[e(D,{modelValue:n.da_mode,"onUpdate:modelValue":l[10]||(l[10]=a=>n.da_mode=a),style:{width:"100%"},clearable:""},{default:t(()=>[e(r,{label:"XML",value:"XML"}),e(r,{label:"XFlash",value:"XFlash"}),e(r,{label:"Legacy",value:"Legacy"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"描述"},{default:t(()=>[e(b,{modelValue:n.description,"onUpdate:modelValue":l[11]||(l[11]=a=>n.description=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),e(m,{label:"选择文件",required:""},{default:t(()=>[e(ge,{ref_key:"uploadRef",ref:de,"auto-upload":!1,limit:1,"on-change":ie,drag:""},{default:t(()=>[e(h,{class:"el-icon--upload"},{default:t(()=>[e(z(Ue))]),_:1}),l[31]||(l[31]=s("div",{class:"el-upload__text"},[_("拖拽文件到这里或 "),s("em",null,"点击上传")],-1))]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(ae,{modelValue:k.value,"onUpdate:modelValue":l[20]||(l[20]=a=>k.value=a),title:"编辑资源",width:"500px"},{footer:t(()=>[e(g,{onClick:l[19]||(l[19]=a=>k.value=!1)},{default:t(()=>[...l[34]||(l[34]=[_("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:ce,loading:j.value},{default:t(()=>[...l[35]||(l[35]=[_("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(le,{model:c,"label-width":"100px"},{default:t(()=>[e(m,{label:"文件名"},{default:t(()=>[e(b,{modelValue:c.filename,"onUpdate:modelValue":l[14]||(l[14]=a=>c.filename=a),disabled:""},null,8,["modelValue"])]),_:1}),e(ee,{gutter:20},{default:t(()=>[e(R,{span:12},{default:t(()=>[e(m,{label:"HW Code"},{default:t(()=>[e(b,{modelValue:c.hw_code,"onUpdate:modelValue":l[15]||(l[15]=a=>c.hw_code=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:12},{default:t(()=>[e(m,{label:"芯片名称"},{default:t(()=>[e(b,{modelValue:c.chip_name,"onUpdate:modelValue":l[16]||(l[16]=a=>c.chip_name=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"DA 模式"},{default:t(()=>[e(D,{modelValue:c.da_mode,"onUpdate:modelValue":l[17]||(l[17]=a=>c.da_mode=a),style:{width:"100%"},clearable:""},{default:t(()=>[e(r,{label:"XML",value:"XML"}),e(r,{label:"XFlash",value:"XFlash"}),e(r,{label:"Legacy",value:"Legacy"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"描述"},{default:t(()=>[e(b,{modelValue:c.description,"onUpdate:modelValue":l[18]||(l[18]=a=>c.description=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ul=De(ol,[["__scopeId","data-v-822e11f4"]]);export{ul as default};
